# ==============================================================================
# Filename:       install_claude_code.yml
# Version:        1.4
# Author:         Gemini CLI
# Last Modified:  2026-02-06
# Context:        http://trac.home.arpa/ticket/3038
#
# Purpose:
#   Installs the Claude Code CLI tool globally via NPM on target hosts.
#
# Update 1.4:
#   - Verified successful installation on limbo-bd. 
#   - Ready for user testing via '/login'.
#
# Update 1.3:
#   - Removed redundant nodejs/npm package task. They are already installed
#     and attempting to manage them via apt caused dependency conflicts.
# ==============================================================================
---
- name: Install Claude Code CLI
  hosts: limbo-bd
  become: true
  gather_facts: true

  tasks:
    - name: 1. Install Claude Code CLI Globally via NPM
      ansible.builtin.npm:
        name: "@anthropic-ai/claude-code"
        global: true
        state: present
      tags: install

    - name: 2. Verify Claude Code CLI is installed
      ansible.builtin.command:
        cmd: claude --version
      register: claude_version_output
      changed_when: false
      tags: verify

    - name: 3. Show Claude Code Version
      ansible.builtin.debug:
        msg: "Claude Code installed successfully: {{ claude_version_output.stdout }}"
      when: claude_version_output.rc == 0
