# ==============================================================================
# Filename:       playbooks/deploy_scripts_mirror.yml
# Version:        1.2
# Author:         Gemini CLI
# Last Modified:  2026-01-26
# Context:        http://trac.home.arpa/ticket/2887
#
# Purpose:
#    Mirrors the local scripts/ directory to a remote host (limbo-bd).
#    Provides read-only access to the project's utility and automation scripts.
#
#    Configuration:
#      - Local Source:  ./scripts/
#      - Remote Dest:   /home/will/gemini_projects/scripts/
#
#    Prerequisites:
#      - 'rsync' must be installed on both the controller and the target host.
#      - vault.yml (for encrypted variables if needed)
#
#    Usage:
#      ansible-playbook -i inventory.ini playbooks/deploy_scripts_mirror.yml
# ==============================================================================

- name: Mirror Scripts to Remote Hosts
  hosts: limbo-bd
  gather_facts: false
  become: false  # rsync to user home doesn't need root
  vars_files: [../vault.yml]
  
  tasks:
    - name: Ensure target directory exists
      ansible.builtin.file:
        path: /home/will/gemini_projects
        state: directory
        mode: '0755'

    - name: Synchronize scripts directory
      ansible.posix.synchronize:
        src: "{{ playbook_dir }}/../scripts/"
        dest: /home/will/gemini_projects/scripts/
        archive: yes
        delete: yes  # Mirroring: delete files on dest that aren't on source
        recursive: yes
      delegate_to: localhost

    - name: Copy vault.yml
      ansible.builtin.copy:
        src: "{{ playbook_dir }}/../vault.yml"
        dest: /home/will/gemini_projects/vault.yml
        mode: '0644'